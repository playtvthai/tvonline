<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>kserietv Extractor</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      color: #eee;
      margin: 0; padding: 20px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    h2, h3, h4 { color: #00bcd4; }
    input, select, button, textarea {
      font-size: 16px;
      padding: 10px;
      margin: 5px 0;
      border-radius: 6px;
      border: none;
    }
    input[type="text"] { width: 70%; }
    select { background: #333; color: #fff; }
    button {
      background: #00bcd4;
      color: white;
      cursor: pointer;
    }
    button:hover { background: #0097a7; }
    textarea {
      width: 100%; height: 150px;
      background: #1e1e1e; color: #00ff6e;
      font-family: monospace;
    }
    .poster {
      max-width: 100%; max-height: 300px;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    .btn-group button, .btn-group a {
      margin-right: 10px; display: inline-block;
    }
    video {
      width: 100%; margin-top: 10px;
      background: black; border: 1px solid #444;
      border-radius: 8px;
    }
    #progressArea {
      margin: 10px 0;
      font-weight: bold;
      color: #80d8ff;
    }
  </style>
</head>
<body>
<h1>
  <a href="https://kserietv.co/" target="_blank" style="text-decoration:none; color:#00bcd4;">
    üì∫ kserietv Extractor
  </a>
</h1>

<a href="https://kserietv.co/" target="_blank" style="display:inline-block; padding:10px 20px; background:#00bcd4; color:white; border-radius:8px; text-decoration:none; font-weight:bold;">
  üì∫ ‡πÑ‡∏õ‡∏¢‡∏±‡∏á kserietv.co ‚Üó
</a>
<form id="urlForm">
  <input type="text" id="urlInput" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏ä‡πà‡∏ô https://kserietv.co/..." required />
  <select id="langSelect">
    <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
    <option value="th">‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢</option>
    <option value="sub">‡∏ã‡∏±‡∏ö‡πÑ‡∏ó‡∏¢</option>
  </select>
  <button type="submit">‡∏î‡∏∂‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
</form>

<div id="progressArea"></div>

<div id="resultArea" style="display:none;">
  <h3 id="title"></h3>
  <img id="poster" class="poster" alt="‡πÇ‡∏õ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå" />

  <h4>.m3u Playlist</h4>
  <textarea id="m3uText" readonly></textarea>

  <div class="btn-group">
    <button onclick="copyText('th')">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å TH</button>
    <button onclick="copyText('sub')">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Sub</button>
    <button onclick="copyText('all')">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    <a id="dlAll" href="#" download="playlist.m3u">‚¨áÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
    <a id="dlTH" href="#" download="playlist_th.m3u">‚¨áÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î TH</a>
    <a id="dlSub" href="#" download="playlist_sub.m3u">‚¨áÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Sub</a>
  </div>

  <h4>üé¨ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡πà‡∏ô (‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢)</h4>
  <select id="playSelectTH">
    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å EP --</option>
  </select>
  <h4>üé¨ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡πà‡∏ô (Sound Track)</h4>
  <select id="playSelectSUB">
    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å EP --</option>
  </select>
  <video id="player" controls muted></video>
</div>

<script>
const progressArea = document.getElementById('progressArea');
const resultArea = document.getElementById('resultArea');
const titleEl = document.getElementById('title');
const posterEl = document.getElementById('poster');
const m3uText = document.getElementById('m3uText');
const playSelectTH = document.getElementById('playSelectTH');
const playSelectSUB = document.getElementById('playSelectSUB');
const player = document.getElementById('player');

let fullM3U = '';

function ensureHttps(url) {
  if (!url) return url;
  if (url.startsWith('http')) return url;
  if (url.startsWith('//')) return 'https:' + url;
  if (url.startsWith('/')) return 'https://kserietv.co' + url;
  return 'https://' + url;
}

function filterM3U(type) {
  const lines = fullM3U.split('\n');
  const filteredLines = [];
  for (let i = 0; i < lines.length; i++) {
    const line = lines[i];
    if (line.startsWith('#EXTM3U')) {
      filteredLines.push(line);
    } else if (line.startsWith('#EXTINF')) {
      if (type === 'all' || line.toLowerCase().includes('(' + type + ')')) {
        filteredLines.push(line);
        if (lines[i+1]) filteredLines.push(lines[i+1]);
      }
      i++;
    }
  }
  return filteredLines.join('\n');
}

document.getElementById('urlForm').addEventListener('submit', e => {
  e.preventDefault();
  resultArea.style.display = 'none';
  progressArea.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';

  player.pause();
  player.removeAttribute('src');
  player.load();

  const url = document.getElementById('urlInput').value.trim();
  const lang = document.getElementById('langSelect').value;

  const es = new EventSource('https://xtream-fast.serv00.net/kseries/sse.php?url=' + encodeURIComponent(url) + '&lang=' + lang);

  es.onmessage = function(event) {
    const data = JSON.parse(event.data);
    progressArea.textContent = data.message + ' (' + data.progress + '%)';

    if (data.progress >= 100) {
      es.close();
      if (data.data) {
        const d = data.data;
        titleEl.textContent = d.title;
        posterEl.src = ensureHttps(d.poster);

        fullM3U = d.m3u.split('\n').map(line => {
          if (line && !line.startsWith('#') && !line.startsWith('http')) {
            return 'https:' + line;
          }
          return line;
        }).join('\n');

        m3uText.value = fullM3U;
        resultArea.style.display = 'block';

        const blobAll = new Blob([filterM3U('all')], {type: 'application/x-mpegURL'});
        const blobTH = new Blob([filterM3U('th')], {type: 'application/x-mpegURL'});
        const blobSub = new Blob([filterM3U('sub')], {type: 'application/x-mpegURL'});

        document.getElementById('dlAll').href = URL.createObjectURL(blobAll);
        document.getElementById('dlTH').href = URL.createObjectURL(blobTH);
        document.getElementById('dlSub').href = URL.createObjectURL(blobSub);

        const lines = fullM3U.split('\n');
        const thUrls = [], subUrls = [];
        for (let i = 0; i < lines.length; i++) {
          if (lines[i].startsWith('#EXTINF')) {
            const url = lines[i+1];
            if (lines[i].toLowerCase().includes('(th)')) thUrls.push(url);
            if (lines[i].toLowerCase().includes('(sub)')) subUrls.push(url);
            i++;
          }
        }

        playSelectTH.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å EP --</option>';
        thUrls.forEach((url, i) => {
          const opt = document.createElement('option');
          opt.value = url;
          opt.textContent = 'EP ' + (i+1);
          playSelectTH.appendChild(opt);
        });

        playSelectSUB.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å EP --</option>';
        subUrls.forEach((url, i) => {
          const opt = document.createElement('option');
          opt.value = url;
          opt.textContent = 'EP ' + (i+1);
          playSelectSUB.appendChild(opt);
        });

        progressArea.textContent = `‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (TH ${thUrls.length} ‡∏ï‡∏≠‡∏ô, SUB ${subUrls.length} ‡∏ï‡∏≠‡∏ô)`;

      } else {
        progressArea.textContent = '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.error;
      }
    }
  };

  es.onerror = function() {
    progressArea.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
    es.close();
  };
});

function playStream(val) {
  if (window.hls) {
    window.hls.destroy();
    window.hls = null;
  }
  if (Hls.isSupported()) {
    const hls = new Hls();
    hls.loadSource(val);
    hls.attachMedia(player);
    hls.on(Hls.Events.MANIFEST_PARSED, function () {
      player.play();
    });
    window.hls = hls;
  } else if (player.canPlayType('application/vnd.apple.mpegurl')) {
    player.src = val;
    player.addEventListener('loadedmetadata', function () {
      player.play();
    });
  } else {
    alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ');
  }
}

playSelectTH.addEventListener('change', () => {
  if (playSelectTH.value) playStream(playSelectTH.value);
});
playSelectSUB.addEventListener('change', () => {
  if (playSelectSUB.value) playStream(playSelectSUB.value);
});

function copyText(type) {
  const text = filterM3U(type);
  navigator.clipboard.writeText(text).then(() => alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: ' + type.toUpperCase()));
}
</script>

</body>
</html>
